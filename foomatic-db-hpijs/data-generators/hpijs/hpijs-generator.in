#!@PERL@
# -*- perl -*-
# hpijs-generator - A generator for the foomatic XML files for HP's "hpijs"
#                   inkjet printer driver (http://hplip.sourceforge.net/)
#
# Copyright 2001-2007 Till Kamppeter <till.kamppeter@gmail.com>
#
#   This program is free software; you can redistribute it and/or
#   modify it under the terms of the GNU General Public License as
#   published by the Free Software Foundation; either version 2 of the
#   License, or (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
#   General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, write to the Free Software
#   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
#   02111-1307, USA.
#

# File and path definitions
my $mapfile = "./hpijs-printermap";
my $kitdir = "./foomatic-db";

# XML file templates
my $hpijs_driver_xml =
"<driver id=\"driver/hpijs\">
 <name>hpijs</name>
 <url>http://hplip.sourceforge.net/</url>
 <supplier>Hewlett-Packard</supplier>
 <manufacturersupplied>HP|Apollo</manufacturersupplied>
 <!--not \"thirdpartysupplied\"-->
 <license>BSD</license>
 <freesoftware />
 <!--not \"nonfreesoftware\"-->
 <supportcontacts>
  <supportcontact level=\"voluntary\" url=\"http://lists.sourceforge.net/mailman/listinfo/hplip-help\">HPLIP-Help Mailing List</supportcontact>
  <!--not level=\"commercial\"-->
 </supportcontacts>
 <shortdescription>
  <en>
   HP's IJS driver for most of their non-PostScript printers
  </en>
 </shortdescription>
 <functionality>
  <maxresx>1200</maxresx>
  <maxresy>1200</maxresy>
  <color />
  <text>90</text>
  <lineart>90</lineart>
  <graphics>100</graphics>
  <photo>100</photo>
  <load></load>
  <speed>70</speed>
 </functionality>
 <execution>
  <nopjl />
  <ijs />
  <prototype>gs -q -dBATCH -dPARANOIDSAFER -dQUIET -dNOPAUSE -sDEVICE=ijs -sIjsServer=hpijs%A%B%C -dIjsUseOutputFD%Z -sOutputFile=- -</prototype>
 </execution>
 <comments>
  <en>

  This driver is the first free driver issued by HP for their DeskJet
  and LaserJet printers. Since version 1.0.1 HP has put it under a
  BSD-like license without the restriction that it is only allowed to
  use the driver with HP printers, as it was the case for HPIJS 1.0
  and earlier. So this driver is really free software now.&lt;P&gt;

  Since version 1.0 the driver uses the new IJS interface to plug in
  drivers into GhostScript without needing to recompile GhostScript,
  the driver is provided by an extra executable invoked by GhostScript
  which gets the raster data from GhostScript via shared memory, which
  is much faster than piping bitmap output into the standard input of
  the driver, in addition GhostScript can ask the driver for the
  capabilities of the printer/driver pair.&lt;P&gt;

  The quality of colour printing is much higher than the quality of
  the other drivers.&lt;P&gt;

  The quality on photo papers (in photo mode) is very high, especially
  for the newer models (beginning from the HP DeskJet 990C) which
  auto-detect the paper type by a hardware facility and so
  automatically switch between the normal colour mode and the photo
  mode. On the HP DeskJet 990C and newer there is also a 1200 dpi high
  resolution mode available, in which the image is interpolated to
  2400x1200 dpi or even 4800x1200 dpi by the hardware, and so it gives
  excellent photo quality. In the new models 6- and 7-ink printing is
  also fully automatically handled by the hardware, so it works under
  free software with this driver and the user does not to switch a
  driver option according to the cartridges he is using. This driver
  is the only free one which supports more than 600 dpi on HP inkjet
  printers.&lt;P&gt;

  This driver supports also monochrome (PCL 5) and color (PCL 5c) laser
  printers with resolutions up to 600 dpi. Most laser printers with
  1200 dpi understand usually PCL 6 or PostScript, so use the
  &quot;pxlmono&quot;, &quot;pxlcolor&quot;, &quot;lj5gray&quot;,
  or &quot;Postscript&quot; drivers then. For Brother laser printers
  use the &quot;hl1240&quot;/&quot;hl1250&quot; drivers. Note that
  Epson&apos;s AcuLaser color printer series only emulates the monochrome
  PCL 5, not PCL 5c. So you have to use Epson&apos;s &quot;alc...&quot;
  drivers to print in color with them.&lt;P&gt;

  This driver supports also duplex (double-sided) printing and
  selection of the paper input tray, if the printer is appropriately
  equipped.&lt;P&gt;

  The driver execution data currently available on this site is for
  version 1.4 (or newer) of HPIJS and IJS 0.33 (available
  in GNU GhostScript 6.53, AFPL GhostScript 7.04, and ESP
  GhostScript 7.05.x). It does not necessarily work
  with older versions of HPIJS and IJS.&lt;P&gt;

  To improve black text output quality use KRGB support. KRGB support
  is available with HPIJS 1.6. KRGB provides image enhanced printing 
  for black text and black line drawings which can not be done with 
  current RGB based raster drivers. KRGB requires Ghostscript support.
  If your copy of Ghostscript does not support KRGB, a Ghostscript KRGB
  patch is included in the HPIJS package. KRGB support requires no 
  foomatic data changes.&lt;P&gt;

  </en>
 </comments>
 <printers>
\@\@PRINTERENTRIES\@\@ </printers>
</driver>
";

my $printerlist_xml = 
"  <printer>
   <id>printer/\@\@PRINTERID\@\@</id>\@\@COMMENT\@\@
\@\@FUNCTIONALITY\@\@\@\@PPDDEFAULTRESOLUTION\@\@   <margins>
\@\@MARGINS\@\@   </margins>
  </printer>
";

my $ppd_default_resolution_xml =
"   <ppdentry>
     *DefaultResolution: \@\@RES\@\@dpi
    </ppdentry>
";

my $general_margins_xml = 
"    <general>
     <unit>in</unit>
     <relative />
\@\@MARGINVALUES\@\@    </general>
";

my $papersize_margins_xml = 
"    <exception PageSize=\"\@\@PAPERSIZE\@\@\">
\@\@MARGINVALUES\@\@    </exception>
";

my $left_margin_xml =
"     <left>\@\@LEFT\@\@</left>
";

my $right_margin_xml =
"     <right>\@\@RIGHT\@\@</right>
";

my $top_margin_xml =
"     <top>\@\@TOP\@\@</top>
";

my $bottom_margin_xml =
"     <bottom>\@\@BOTTOM\@\@</bottom>
";

my $hpijs_model_xml =
"<option type=\"enum\" id=\"opt/hpijs-Model\">
  <!-- A multilingual <comments> block can appear here, too;
       it should be treated as documentation for the user. -->
  <arg_longname>
   <en>Model</en>
  </arg_longname>
  <arg_shortname>
   <en>Model</en><!-- backends only know <en> shortnames! -->
  </arg_shortname>
  <arg_execution>
   <arg_order>100</arg_order>
   <arg_spot>A</arg_spot>
   <arg_required />
   <arg_substitution />
   <arg_proto> %s</arg_proto>
  </arg_execution>
  <constraints>
\@\@MODELCONSTRAINTS\@\@  </constraints>
  <enum_vals>
\@\@MODELENUMVALS\@\@  </enum_vals>
</option>
";

my $hpijs_pagesize_xml = 
"<option type=\"enum\" id=\"opt/hpijs-PageSize\">
  <!-- A multilingual <comments> block can appear here, too;
       it should be treated as documentation for the user. -->
  <arg_longname>
   <en>Page Size</en>
  </arg_longname>
  <arg_shortname>
   <en>PageSize</en><!-- backends only know <en> shortnames! -->
  </arg_shortname>
  <arg_execution>
   <arg_group>General</arg_group>
   <arg_order>105</arg_order>
   <arg_spot>A</arg_spot>
   <arg_substitution />
   <arg_proto>%s</arg_proto>
  </arg_execution>
  <constraints>
\@\@PAGESIZECONSTRAINTS\@\@  </constraints>
  <enum_vals>
   <enum_val id=\"ev/hpijs-PageSize-Custom\">
    <ev_longname>
     <en>Custom size</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>Custom</en>
     <!-- Until someone tells me how to learn the user locale in
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval> -dDEVICEWIDTHPOINTS=0 -dDEVICEHEIGHTPOINTS=0</ev_driverval>
   </enum_val>
\@\@PAGESIZEENUMVALS\@\@  </enum_vals>
</option>
";

my $hpijs_quality_xml = 
"<option type=\"enum\" id=\"opt/hpijs-Quality\">
  <!-- A multilingual <comments> block can appear here, too;
       it should be treated as documentation for the user. -->
  <arg_longname>
   <en>Resolution, Quality, Ink Type, Media Type</en>
  </arg_longname>
  <arg_shortname>
   <!-- We do not take \"Resolution\" as short name here, as the choices -->
   <!-- of this option cannot be mapped to names like \"300dpi\", -->
   <!-- \"600x300dpi\", ... and the Adobe PPD specs require such names -->
   <!-- for the choices of the \"Resolution\" option --> 
   <en>Quality</en><!-- backends only know <en> shortnames! -->
  </arg_shortname>
  <arg_execution>
   <arg_group>Extra</arg_group>
   <arg_order>100</arg_order>
   <arg_spot>B</arg_spot>
   <arg_substitution />
   <arg_proto> -r%s</arg_proto>
  </arg_execution>
  <constraints>
\@\@QUALITYCONSTRAINTS\@\@  </constraints>
  <enum_vals>
\@\@QUALITYENUMVALS\@\@  </enum_vals>
</option>
";

my $hpijs_printoutmode_xml = 
"<option type=\"enum\" id=\"opt/hpijs-PrintoutMode\">
  <!-- A multilingual <comments> block can appear here, too;
       it should be treated as documentation for the user. -->
  <arg_longname>
   <en>Printout Mode</en>
  </arg_longname>
  <arg_shortname>
   <en>PrintoutMode</en><!-- backends only know <en> shortnames! -->
  </arg_shortname>
  <arg_execution>
   <arg_group>General</arg_group>
   <arg_order>10</arg_order>
   <arg_spot>B</arg_spot>
   <arg_composite />
   <arg_proto>%s</arg_proto>
  </arg_execution>
  <constraints>
\@\@PRINTOUTMODECONSTRAINTS\@\@  </constraints>
  <enum_vals>
\@\@PRINTOUTMODEENUMVALS\@\@  </enum_vals>
</option>
";

my $hpijs_inputslot_xml = 
"<option type=\"enum\" id=\"opt/hpijs-InputSlot\">
  <!-- A multilingual <comments> block can appear here, too;
       it should be treated as documentation for the user. -->
  <arg_longname>
   <en>Media Source</en>
  </arg_longname>
  <arg_shortname>
   <en>InputSlot</en><!-- backends only know <en> shortnames! -->
  </arg_shortname>
  <arg_execution>
   <arg_group>General</arg_group>
   <arg_order>100</arg_order>
   <arg_spot>C</arg_spot>
   <arg_required />
   <arg_substitution />
   <arg_proto>,PS:MediaPosition=%s</arg_proto>
  </arg_execution>
  <constraints>
\@\@INPUTSLOTCONSTRAINTS\@\@  </constraints>
  <enum_vals>
   <enum_val id=\"ev/hpijs-InputSlot-Default\">
    <ev_longname>
     <en>Printer default</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>Default</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>7</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-InputSlot-PhotoTray\">
    <ev_longname>
     <en>Photo Tray</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>PhotoTray</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>6</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-InputSlot-Manual\">
    <ev_longname>
     <en>Manual Feeder</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>Manual</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>2</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-InputSlot-Envelope\">
    <ev_longname>
     <en>Envelope Feeder</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>Envelope</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>3</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-InputSlot-MPTray\">
    <ev_longname>
     <en>Multi Purpose Tray</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>MPTray</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>8</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-InputSlot-Upper\">
    <ev_longname>
     <en>Upper Tray</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>Upper</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>1</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-InputSlot-Lower\">
    <ev_longname>
     <en>Lower Tray</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>Lower</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>4</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-InputSlot-LargeCapacity\">
    <ev_longname>
     <en>Large Capacity Tray</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>LargeCapacity</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>5</ev_driverval>
   </enum_val>
<enum_val id=\"ev/hpijs-InputSlot-CDDVDTray\">
    <ev_longname>
     <en>CD or DVD Tray</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>CDDVDTray</en>
     <!-- Until someone tells me how to learn the user locale in 
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>14</ev_driverval>
   </enum_val>
  </enum_vals>
</option>
";


my $hpijs_duplex_xml = 
"<option type=\"enum\" id=\"opt/hpijs-Duplex\">
  <!-- A multilingual <comments> block can appear here, too;
       it should be treated as documentation for the user. -->
  <arg_longname>
   <en>Double-Sided Printing</en>
  </arg_longname>
  <arg_shortname>
   <en>Duplex</en><!-- backends only know <en> shortnames! -->
  </arg_shortname>
  <arg_execution>
   <arg_group>General</arg_group>
   <arg_order>120</arg_order>
   <arg_spot>A</arg_spot>
   <arg_substitution />
   <arg_proto> -dDuplex=%s</arg_proto>
  </arg_execution>
  <constraints>
\@\@DUPLEXCONSTRAINTS\@\@  </constraints>
  <enum_vals>
   <enum_val id=\"ev/hpijs-Duplex-None\">
    <ev_longname>
     <en>Off</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>None</en>
     <!-- Until someone tells me how to learn the user locale in
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>false</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-Duplex-DuplexNoTumble\">
    <ev_longname>
     <en>Long Edge (Standard)</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>DuplexNoTumble</en>
     <!-- Until someone tells me how to learn the user locale in
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>true -dTumble=false</ev_driverval>
   </enum_val>
   <enum_val id=\"ev/hpijs-Duplex-DuplexTumble\">
    <ev_longname>
     <en>Short Edge (Flip)</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>DuplexTumble</en>
     <!-- Until someone tells me how to learn the user locale in
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>true -dTumble=true</ev_driverval>
   </enum_val>
  </enum_vals>
</option>
";

my $hpijs_option_constraint_xml =
"     <constraint sense='true'>
      <driver>hpijs</driver>
      <printer>printer/\@\@PRINTERID\@\@</printer>\@\@COMMENT\@\@
      <arg_defval>ev/\@\@DEFAULTENUMVALID\@\@</arg_defval>
     </constraint>
";

my $hpijs_enum_val_xml =
"   <enum_val id=\"ev/\@\@ENUMVALID\@\@\">
    <ev_longname>
     <en>\@\@LONGNAME\@\@</en>
    </ev_longname>
    <!-- A multilingual <comments> block can appear here, too;
         it should be treated as documentation for the user. -->
    <ev_shortname>
     <en>\@\@SHORTNAME\@\@</en>
     <!-- Until someone tells me how to learn the user locale in
          backends, the shortname must be monolingual in <en>! -->
    </ev_shortname>
    <ev_driverval>\@\@DRIVERVALUE\@\@</ev_driverval>
    <constraints>
     <!-- Assume the choice doesn't apply... -->
     <constraint sense='false'>
      <driver>hpijs</driver>
     </constraint>
     <!-- ...except to these: -->
\@\@ENUMVALCONSTRAINTS\@\@    </constraints>
   </enum_val>
";

my $hpijs_enum_val_constraint_xml =
"     <constraint sense='true'>
      <driver>hpijs</driver>
      <printer>printer/\@\@PRINTERID\@\@</printer>\@\@COMMENT\@\@
     </constraint>
";

# Available paper size values (the "constraints" fields will be filled
# in with the appropriate printers when the printer list is parsed

my @pagesize_order = qw/Letter Legal Ledger Executive 
                        A3 A4 A5 Photo5x7 A6 A6TearOff
                        Photo PhotoTearOff
                        B4JIS B5JIS
                        Oufuku Hagaki
                        SuperB FLSA
                        Env10 EnvMonarch EnvDL EnvC5 EnvC6 EnvISOB5 3x5 5x8
                        w612h935 w558h774 w774h1116 
                        3425-Cover CDDVD80 CDDVD120/;
my @pagesize_size_order = qw/SuperB A3 Ledger w774h1116 B4JIS 
                             3425-Cover Legal FLSA
	                     w612h935 Letter A4 w558h774 Executive B5JIS 
                             EnvISOB5 EnvC5 A5 Oufuku 5x8
                             EnvDL Env10 EnvMonarch EnvC6
                             Photo5x7 CDDVD120 A6TearOff A6 PhotoTearOff Photo Hagaki 3x5 CDDVD80/;

# The margin information is taken from the "context.cpp" file of HPIJS,
# PrintContext::PSM data structure
my $pagesize_vals = { 
    'Letter' => { 
	'longname' => 'Letter',
	'driverval' => ' -dDEVICEWIDTHPOINTS=612 -dDEVICEHEIGHTPOINTS=792',
	'margins' => {
	    'width' => 8.5,
	    'height' => 11.0,
	    'printablewidth' => 8.0,
	    'printableheight' => 10.375,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'Legal' => { 
	'longname' => 'Legal',
	'driverval' => ' -dDEVICEWIDTHPOINTS=612 -dDEVICEHEIGHTPOINTS=1008',
	'margins' => {
	    'width' => 8.5,
	    'height' => 14.0,
	    'printablewidth' => 8.0,
	    'printableheight' => 13.375,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'Ledger' => { 
	'longname' => 'Ledger',
	'driverval' => ' -dDEVICEWIDTHPOINTS=792 -dDEVICEHEIGHTPOINTS=1224',
	'margins' => {
	    'width' => 11.0,
	    'height' => 17.0,
	    'printablewidth' => 10.6,
	    'printableheight' => 16.375,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'Executive' => { 
	'longname' => 'Executive',
	'driverval' => ' -dDEVICEWIDTHPOINTS=522 -dDEVICEHEIGHTPOINTS=756',
	'margins' => {
	    'width' =>7.25,
	    'height' => 10.5,
	    'printablewidth' => 6.75,
	    'printableheight' => 9.875,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'A3' => { 
	'longname' => 'A3',
	'driverval' => ' -dDEVICEWIDTHPOINTS=842 -dDEVICEHEIGHTPOINTS=1190',
	'margins' => {
	    'width' => 11.69,
	    'height' => 16.53,
	    'printablewidth' => 11.29,
	    'printableheight' => 15.905,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'A4' => { 
	'longname' => 'A4',
	'driverval' => ' -dDEVICEWIDTHPOINTS=595 -dDEVICEHEIGHTPOINTS=842',
	'margins' => {
	    'width' => 8.27,
	    'height' => 11.69,
	    'printablewidth' => 8.0,
	    'printableheight' => 11.065,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'A5' => { 
	'longname' => 'A5',
	'driverval' => ' -dDEVICEWIDTHPOINTS=420 -dDEVICEHEIGHTPOINTS=595',
	'margins' => {
	    'width' => 5.83,
	    'height' => 8.27,
	    'printablewidth' => 5.58,
	    'printableheight' => 7.645,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'A6' => { 
	'longname' => 'A6',
	'driverval' => ' -dDEVICEWIDTHPOINTS=297 -dDEVICEHEIGHTPOINTS=420',
	'margins' => {
	    'width' => 4.13,
	    'height' => 5.83,
	    'printablewidth' => 3.88,
	    'printableheight' => 5.205,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'A6TearOff' => { 
	'longname' => 'A6 with tear-off tab',
	'driverval' => ' -dDEVICEWIDTHPOINTS=297 -dDEVICEHEIGHTPOINTS=420',
	'margins' => {
	    'width' => 4.13,
	    'height' => 5.83,
	    'printablewidth' => 3.88,
	    'printableheight' => 5.705,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'Photo' => { 
	'longname' => 'Photo or 4x6 inch index card',
	'driverval' => ' -dDEVICEWIDTHPOINTS=288 -dDEVICEHEIGHTPOINTS=432',
	'margins' => {
	    'width' => 4.0,
	    'height' => 6.0,
	    'printablewidth' => 3.75,
	    'printableheight' => 5.375,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'Photo5x7' => {
        'longname' => 'Photo or 5x7 inch index card',
        'driverval' => ' -dDEVICEWIDTHPOINTS=360 -dDEVICEHEIGHTPOINTS=504',
        'margins' => {
            'width' => 5.0,
            'height' => 7.0,
            'printablewidth' => 4.75,
            'printableheight' => 6.375,
            'topmargin' => 0.125
        },
        'constraints' => ""
    },
    'PhotoTearOff' => { 
	'longname' => 'Photo with tear-off tab',
	'driverval' => ' -dDEVICEWIDTHPOINTS=288 -dDEVICEHEIGHTPOINTS=432',
	'margins' => {
	    'width' => 4.0,
	    'height' => 6.0,
	    'printablewidth' => 3.75,
	    'printableheight' => 5.75,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'B4JIS' => { 
	'longname' => 'B4 (JIS)',
	'driverval' => ' -dDEVICEWIDTHPOINTS=729 -dDEVICEHEIGHTPOINTS=1033',
	'margins' => {
	    'width' => 10.126,
	    'height' => 14.342,
	    'printablewidth' => 9.626,
	    'printableheight' => 13.717,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'B5JIS' => { 
	'longname' => 'B5 (JIS)',
	'driverval' => ' -dDEVICEWIDTHPOINTS=516 -dDEVICEHEIGHTPOINTS=729',
	'margins' => {
	    'width' => 7.17,
	    'height' => 10.126,
	    'printablewidth' => 6.67,
	    'printableheight' => 9.501,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'Oufuku' => { 
	'longname' => 'Oufuku-Hagaki',
	'driverval' => ' -dDEVICEWIDTHPOINTS=420 -dDEVICEHEIGHTPOINTS=567',
	'margins' => {
	    'width' => 5.83,
	    'height' => 7.87,
	    'printablewidth' => 5.33,
	    #'printableheight' => 7.37,
	    'printableheight' => 7.245, # Correction, lower border must be
	                                # 0.5 inches.
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'Hagaki' => { 
	'longname' => 'Hagaki',
	'driverval' => ' -dDEVICEWIDTHPOINTS=283 -dDEVICEHEIGHTPOINTS=420',
	'margins' => {
	    'width' => 3.94,
	    'height' => 5.83,
	    'printablewidth' => 3.69,
	    #'printableheight' => 5.58,
	    'printableheight' => 5.205, # Correction, lower border must be
	                                # 0.5 inches.
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'SuperB' => { 
	'longname' => 'Super B',
	'driverval' => ' -dDEVICEWIDTHPOINTS=936 -dDEVICEHEIGHTPOINTS=1368',
	'margins' => {
	    'width' => 13.00,
	    'height' => 19.00,
	    'printablewidth' => 12.6,
	    'printableheight' => 18.375,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'FLSA' => { 
	'longname' => 'American Foolscap',
	'driverval' => ' -dDEVICEWIDTHPOINTS=612 -dDEVICEHEIGHTPOINTS=936',
	'margins' => {
	    'width' => 8.5,
	    'height' => 13.0,
	    'printablewidth' => 8.00,
	    'printableheight' => 12.375,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },
    'CDDVD80' => { 
	'longname' => 'CD or DVD 80 mm',
	'driverval' => ' -dDEVICEWIDTHPOINTS=237 -dDEVICEHEIGHTPOINTS=237',
	'margins' => {
	    'width' => 3.3,
	    'height' => 3.3,
	    'printablewidth' => 3.3,
	    'printableheight' => 3.3,
	    'topmargin' => 0.0
	},
	'constraints' => ""
    },
    'CDDVD120' => { 
	'longname' => 'CD or DVD 120 mm',
	'driverval' => ' -dDEVICEWIDTHPOINTS=360 -dDEVICEHEIGHTPOINTS=360',
	'margins' => {
	    'width' => 5.0,
	    'height' => 5.0,
	    'printablewidth' => 5.00,
	    'printableheight' => 5.00,
	    'topmargin' => 0.0
	},
	'constraints' => ""
    },

    # Extra paper sizes which are not explicitly handled by the HPIJS code
    # but accepted as custom paper sizes. They are included because they
    # are commonly used. If no margins are given, the default margins are
    # used.

    # Cover for the HP DeskJet 3425
    '3425-Cover' => {
	'longname' => 'Cover for HP DeskJet 3425',
	'driverval' => ' -dDEVICEWIDTHPOINTS=612 -dDEVICEHEIGHTPOINTS=1116',
	'margins' => {
	    'width' => 8.5,
	    'height' => 15.5,
	    'printablewidth' => 8.00,
	    'printableheight' => 14.875,
	    'topmargin' => 0.125
	},
	'constraints' => ""
    },

    # Envelopes
    'Env10' => {
	'longname' => 'Envelope #10',
	'driverval' => ' -dDEVICEWIDTHPOINTS=297 -dDEVICEHEIGHTPOINTS=684',
	'constraints' => ""
    },
    'EnvMonarch' => {
	'longname' => 'Envelope Monarch',
	'driverval' => ' -dDEVICEWIDTHPOINTS=279 -dDEVICEHEIGHTPOINTS=540',
	'constraints' => ""
    },
    'EnvDL' => {
	'longname' => 'Envelope DL',
	'driverval' => ' -dDEVICEWIDTHPOINTS=312 -dDEVICEHEIGHTPOINTS=624',
	'constraints' => ""
    },
    'EnvC5' => {
	'longname' => 'Envelope C5',
	'driverval' => ' -dDEVICEWIDTHPOINTS=459 -dDEVICEHEIGHTPOINTS=649',
	'constraints' => ""
    },
    'EnvC6' => {
	'longname' => 'Envelope C6',
	'driverval' => ' -dDEVICEWIDTHPOINTS=323 -dDEVICEHEIGHTPOINTS=459',
	'constraints' => ""
    },
    'EnvISOB5' => {
	'longname' => 'Envelope B5',
	'driverval' => ' -dDEVICEWIDTHPOINTS=499 -dDEVICEHEIGHTPOINTS=709',
	'constraints' => ""
    },
    
    # Index cards
    '3x5' => {
	'longname' => '3x5 inch index card',
	'driverval' => ' -dDEVICEWIDTHPOINTS=216 -dDEVICEHEIGHTPOINTS=360',
	'constraints' => ""
    },
    '5x8' => {
	'longname' => '5x8 inch index card',
	'driverval' => ' -dDEVICEWIDTHPOINTS=360 -dDEVICEHEIGHTPOINTS=576',
	'constraints' => ""
    },

    # Misc sizes
    'w612h935' => {
	'longname' => 'Executive (JIS)',
	'driverval' => ' -dDEVICEWIDTHPOINTS=612 -dDEVICEHEIGHTPOINTS=935',
	'constraints' => ""
    },
    'w558h774' => {
	'longname' => '16K',
	'driverval' => ' -dDEVICEWIDTHPOINTS=558 -dDEVICEHEIGHTPOINTS=774',
	'constraints' => ""
    },
    'w774h1116' => {
	'longname' => '8K',
	'driverval' => ' -dDEVICEWIDTHPOINTS=774 -dDEVICEHEIGHTPOINTS=1116',
	'constraints' => ""
    },
};

# Some unprintable margins sets

# General margins for the current inkjets
my $general_margins = {
    'top' => 0.125,
    'bottom' => 0.5,
    'left' => 0.25,
    'right' => 0.25,
};

# Margins for older inkjets (AP2xxx, AP21xx, AP2560, DJ350. DJ400, DJ500,
# DJ540, DJ600, DJ6xx, DJ630, DJ6xxPhoto)
my $oldinkjet_bottom = 0.67;
my $oldinkjet_a4_sides = 0.135;

# Margins for photos/cards on the DeskJet 450 (DJ450)
my $dj450_photo_margins = {
    'top' => 0.125,
    'bottom' => 0.250,
    'bottomtearoff' => 0.125,
    'left' => 0.125,
    'right' => 0.125,
};

# General margins for the laser printers (LJMono, LJMono300, LJColor, 
# LJColor300)
my $general_laser_margins = {
    'top' => 0.2,
    'bottom' => 0.2,
};

# Available quality values (the "constraints" fields will be filled in with
# the appropriate printers when the printer list is parsed

my @quality_order = qw/150DraftGrayscaleCMYK 150DraftColorCMYK
		       150GrayscaleCMYK 150ColorCMYK 150BestColorCMYK
		       300DraftGrayscaleK 600DraftGrayscaleK
                       300DraftGrayscaleCMYK 300FastDraftGrayscaleCMYK
                       300DraftColorCMY 300DraftColorCMYK 300FastDraftColorCMYK
                       300GrayscaleK 300GrayscaleCMYK
                       300ColorCMY 300ColorCMYFullBleed 300ColorCMYK
                       300ColorCMYKFullBleed
                       300PhotoCMY 300PhotoCMYK 300PhotoCMYKFullBleed
                       300PhotoCMYcmK
                       300BestGrayscaleK 300BestGrayscaleCMYK
                       300BestColorCMYK
                       600x300BestGrayscaleK 600x300BestGrayscaleCMYK
                       600DraftGrayscaleK 600DraftColorCMY
                       600DraftColorCMYK
                       600GrayscaleK 600GrayscaleCMYK
                       600ColorCMY 600ColorCMYFullBleed 600ColorCMYK
                       600ColorCMYKFullBleed 600PhotoNormalCMYK
                       600PhotoCMY 600PhotoCMYK 600PhotoCMYKFullBleed
                       600BestColorCMYK
                       600PhotoCMYcmK 600PhotoCMYcmKFullBleed
                       1200PhotoCMY 1200PhotoCMYFullBleed 1200PhotoCMYK
                       1200PhotoCMYKFullBleed 600CDDVDCMYK/;
my $quality_vals = { 
    '300GrayscaleK' => { 
	'longname' => '300 dpi, Grayscale, Black Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=0,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=0',
	'constraints' => ""
    },
    '300DraftGrayscaleK' => { 
	'longname' => '300 dpi, Draft, Grayscale, Black Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=1,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=0',
	'constraints' => ""
    },
    '600DraftGrayscaleK' => { 
	'longname' => '600 dpi, Draft, Grayscale, Black Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=1,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=0',
	'constraints' => ""
    },
    '300BestGrayscaleK' => { 
	'longname' => '300 dpi, Best, Grayscale, Black Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=0',
	'constraints' => ""
    },
    '600GrayscaleK' => { 
	'longname' => '600 dpi, Grayscale, Black Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=0,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=0',
	'constraints' => ""
    },
    '600x300BestGrayscaleK' => { 
	'longname' => '600x300 dpi, Best, Grayscale, Black Cartr.',
	'driverval' => 
	    '600x300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=0',
	'constraints' => ""
    },
    '600x300BestGrayscaleCMYK' => { 
	'longname' => '600x300 dpi, Best, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '600x300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },'600PhotoCMYcmKFullBleed' => {
	'longname' => '600 dpi, Photo, Full Bleed, Photo + Color Cartr., Photo Paper',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=4,Quality:FullBleed=1',
	'constraints' => ""
    },
    '150GrayscaleCMYK' => { 
	'longname' => '150 dpi, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '150 -sIjsParams=Quality:Quality=0,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300GrayscaleCMYK' => { 
	'longname' => '300 dpi, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=0,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '150DraftGrayscaleCMYK' => { 
	'longname' => '150 dpi, Draft, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '150 -sIjsParams=Quality:Quality=1,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300DraftGrayscaleCMYK' => { 
	'longname' => '300 dpi, Draft, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=1,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300FastDraftGrayscaleCMYK' => { 
	'longname' => '300 dpi, FastDraft, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=4,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300BestGrayscaleCMYK' => { 
	'longname' => '300 dpi, Best, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '600GrayscaleCMYK' => { 
	'longname' => '600 dpi, Grayscale, Black + Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=0,Quality:ColorMode=0,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300ColorCMY' => {
	'longname' => '300 dpi, Color, Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=1',
	'constraints' => ""
    },
    '300DraftColorCMY' => {
	'longname' => '300 dpi, Draft, Color, Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=1,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=1',
	'constraints' => ""
    },
    '600DraftColorCMY' => {
	'longname' => '600 dpi, Draft, Color, Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=1,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=1',
	'constraints' => ""
    },
    '600ColorCMY' => {
	'longname' => '600 dpi, Color, Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=1',
	'constraints' => ""
    },
    '1200PhotoCMY' => {
	'longname' => '1200 dpi, Photo, Color Cartr., Photo Paper',
	'driverval' => 
	    '1200 -sIjsParams=Quality:Quality=3,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=1',
	'constraints' => ""
    },
    '150ColorCMYK' => {
	'longname' => '150 dpi, Color, Black + Color Cartr.',
	'driverval' => 
	    '150 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300ColorCMYK' => {
	'longname' => '300 dpi, Color, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '150DraftColorCMYK' => {
	'longname' => '150 dpi, Draft, Color, Black + Color Cartr.',
	'driverval' => 
	    '150 -sIjsParams=Quality:Quality=1,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300DraftColorCMYK' => {
	'longname' => '300 dpi, Draft, Color, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=1,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '600DraftColorCMYK' => {
	'longname' => '600 dpi, Draft, Color, Black + Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=1,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300FastDraftColorCMYK' => {
	'longname' => '300 dpi, FastDraft, Color, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=4,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '600ColorCMYK' => {
	'longname' => '600 dpi, Color, Black + Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '150BestColorCMYK' => {
	'longname' => '150 dpi, Best, Color, Black + Color Cartr.',
	'driverval' => 
	    '150 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300BestColorCMYK' => {
	'longname' => '300 dpi, Best, Color, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '600BestColorCMYK' => {
	'longname' => '600 dpi, Best, Color, Black + Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2',
	'constraints' => ""
    },
    '300PhotoCMYcmK' => {
	'longname' => '300 dpi, Photo, Photo + Color Cartr., Premium Paper',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=1,Quality:PenSet=4',
	'constraints' => ""
    },
    '300PhotoCMYK' => {
	'longname' => '300 dpi, Photo, Black + Color Cartr., Photo Paper',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=2',
	'constraints' => ""
    },
    '600PhotoCMYK' => {
	'longname' => '600 dpi, Photo, Black + Color Cartr., Photo Paper',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=2',
	'constraints' => ""
    },
    '300PhotoCMYKFullBleed' => {
	'longname' => '300 dpi, Photo, Full Bleed, Black + Color Cartr., Photo Paper',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=2,Quality:FullBleed=1',
	'constraints' => ""
    },
    '600PhotoCMYKFullBleed' => {
	'longname' => '600 dpi, Photo, Full Bleed, Black + Color Cartr., Photo Paper',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=2,Quality:FullBleed=1',
	'constraints' => ""
    },
    '300PhotoCMY' => {
	'longname' => '300 dpi, Photo, Color Cartr., Photo Paper',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=1',
	'constraints' => ""
    },
    '600PhotoCMY' => {
	'longname' => '600 dpi, Photo, Color Cartr., Photo Paper',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=1',
	'constraints' => ""
    },
    '1200PhotoCMYK' => {
	'longname' => '1200 dpi, Photo, Black + Color Cartr., Photo Paper',
	'driverval' => 
	    '1200 -sIjsParams=Quality:Quality=3,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=2',
	'constraints' => ""
    },
    '300ColorCMYFullBleed' => {
	'longname' => '300 dpi, Color, Full Bleed, Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=1,Quality:FullBleed=1',
	'constraints' => ""
    },
    '300ColorCMYKFullBleed' => {
	'longname' => '300 dpi, Color, Full Bleed, Black + Color Cartr.',
	'driverval' => 
	    '300 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2,Quality:FullBleed=1',
	'constraints' => ""
    },
    '600ColorCMYFullBleed' => {
	'longname' => '600 dpi, Color, Full Bleed, Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=1,Quality:FullBleed=1',
	'constraints' => ""
    },
    '600ColorCMYKFullBleed' => {
	'longname' => '600 dpi, Color, Full Bleed, Black + Color Cartr.',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=0,Quality:PenSet=2,Quality:FullBleed=1',
	'constraints' => ""
    },
    '600PhotoNormalCMYK' => {
	'longname' => '600 dpi, Color, Black + Color Cartr., Photo Paper, Normal',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=0,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=2',
	'constraints' => ""
    },
    '1200PhotoCMYFullBleed' => {
	'longname' => '1200 dpi, Photo, Full Bleed, Color Cartr., Photo Paper',
	'driverval' => 
	    '1200 -sIjsParams=Quality:Quality=3,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=1,Quality:FullBleed=1',
	'constraints' => ""
    },
    '1200PhotoCMYKFullBleed' => {
	'longname' => '1200 dpi, Photo, Full Bleed, Black + Color Cartr., Photo Paper',
	'driverval' => 
	    '1200 -sIjsParams=Quality:Quality=3,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=2,Quality:FullBleed=1',
	'constraints' => ""
    },
    '600PhotoCMYcmK' => {
	'longname' => '600 dpi, Photo, Photo + Color Cartr., Photo Paper',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=4',
	'constraints' => ""
    },
    '600PhotoCMYcmKFullBleed' => {
	'longname' => '600 dpi, Photo, Full Bleed, Photo + Color Cartr., Photo Paper',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=2,Quality:PenSet=4,Quality:FullBleed=1',
	'constraints' => ""
    },
    '600CDDVDCMYK' => {
	'longname' => '600 dpi, Black + Color Cartr., CD or DVD',
	'driverval' => 
	    '600 -sIjsParams=Quality:Quality=2,Quality:ColorMode=2,Quality:MediaType=7,Quality:PenSet=2',
	'constraints' => ""
    },
};

# The HP printers can be classified in groups, where all printers in
# one group are compatible to each other and work with the same options.

my $printer_groups = {
    'DJ350' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleK 300DraftColorCMY ' .
	                 '300GrayscaleK 300ColorCMY ' .
	                 '600x300BestGrayscaleK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black cartridge)',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black cartridge)',
		'value' => 'Quality=300GrayscaleK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black cartridge)',
		'value' => 'Quality=600x300BestGrayscaleK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'DJ500' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300GrayscaleK',
	'QualityVals' => '300DraftGrayscaleK 300GrayscaleK',
	'PPDDefaultResolution' => '300',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300GrayscaleK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>300</maxresx>
    <maxresy>300</maxresy>
    <monochrome />
   </functionality>
'
    },
    'DJ540' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleK 300DraftColorCMY ' .
	                 '300GrayscaleK 300ColorCMY',
	'PPDDefaultResolution' => '300',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black cartridge)',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black cartridge)',
		'value' => 'Quality=300GrayscaleK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>300</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'DJ630' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleK 300DraftColorCMY ' .
	                 '300DraftColorCMYK ' .
	                 '300GrayscaleK 300ColorCMY 300ColorCMYK ' .
			 '300PhotoCMYcmK ' .
	                 '600x300BestGrayscaleK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black cartridge)',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black cartridge)',
		'value' => 'Quality=300GrayscaleK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black cartridge)',
		'value' => 'Quality=600x300BestGrayscaleK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Photo + color cartridge, photo paper)',
		'value' => 'Quality=300PhotoCMYcmK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'DJ600' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' .
	                 '300GrayscaleCMYK 300ColorCMYK ' .
	                 '600x300BestGrayscaleCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600x300BestGrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'DJ6xx' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' .
	                 '300GrayscaleCMYK 300ColorCMYK ' .
	                 '600x300BestGrayscaleCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600x300BestGrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'DJ6xxPhoto' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' .
	                 '300GrayscaleCMYK 300ColorCMYK ' . 
			 '300PhotoCMYcmK ' .
	                 '600x300BestGrayscaleCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600x300BestGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Photo + color cartridge, photo paper)',
		'value' => 'Quality=300PhotoCMYcmK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'DJ8xx' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
	                 '300ColorCMYK ' . 
			 '300PhotoCMYK 600PhotoCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=600PhotoCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ8x5' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleK ' .
                         '300DraftColorCMY 300DraftColorCMYK ' .
                         '300GrayscaleK 600GrayscaleK ' .
                         '300ColorCMY 300ColorCMYK ' .
                         '300PhotoCMY 600PhotoCMY ' .
			 '300PhotoCMYK 600PhotoCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black cartridge)',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black cartridge)',
		'value' => 'Quality=300GrayscaleK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black cartridge)',
		'value' => 'Quality=600GrayscaleK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Color cartridge, on photo paper)',
		'value' => 'Quality=600PhotoCMY',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ850' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
	                 '300ColorCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ890' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
	                 '300ColorCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ9xx' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
			 '300ColorCMYK 300DraftGrayscaleK 600GrayscaleK ' . 
			 '300BestColorCMYK 600BestColorCMYK ' . 
			 '300PhotoCMYK 600PhotoCMYK 1200PhotoCMYK',
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 0,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality',
		'value' => 'Quality=600BestColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
	    'Draft.GrayK' => {
		'longname' => 'High Quality',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal.GrayK' => {
		'longname' => 'High Quality',
		'value' => 'Quality=600GrayscaleK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYK',
		'constraints' => ''
	    }
	}
    },
    'HP2xxx' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
	                 '300ColorCMYK ' .
			 '300BestColorCMYK 600BestColorCMYK', 
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality',
		'value' => 'Quality=600BestColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ1120' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
	                 '300ColorCMYK ',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ9xxVIP' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
			 '300ColorCMYK 600ColorCMYK 1200PhotoCMYK ' .
			 '600PhotoNormalCMYK 600PhotoCMYK',
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (auto-detect paper type)',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (auto-detect paper type)',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (auto-detect paper type)',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (auto-detect paper type)',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (auto-detect paper type)',
		'value' => 'Quality=600ColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (auto-detect paper type)',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
            'PhotoNormal' => {
		'longname' => 'Normal Quality (color on photo paper)',
		'value' => 'Quality=600PhotoNormalCMYK',
		'constraints' => ''
	    },
           'PhotoBest' => {
		'longname' => 'Best Quality (color on photo paper)',
		'value' => 'Quality=600PhotoCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYK',
		'constraints' => ''
	    }
	}
    },
    'BI22xx' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
			 '300ColorCMYK 600ColorCMYK ' .
			 '300PhotoCMYK 600PhotoCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (auto-detect paper type)',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality',
		'value' => 'Quality=600ColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=600PhotoCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJGenericVIP' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300FastDraftGrayscaleCMYK 300DraftColorCMYK 300FastDraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
			 '300ColorCMYK 300ColorCMYKFullBleed ' .
			 '600ColorCMYK 600ColorCMYKFullBleed ' .
			 '1200PhotoCMYK 1200PhotoCMYKFullBleed',
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (auto-detect paper type)',
		'value' => 'Quality=300FastDraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (auto-detect paper type)',
		'value' => 'Quality=300FastDraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (auto-detect paper type)',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (auto-detect paper type)',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (auto-detect paper type)',
		'value' => 'Quality=600ColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (auto-detect paper type)',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYKFullBleed',
		'constraints' => ''
	    }
	}
    },
    'PS_D5100' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300FastDraftGrayscaleCMYK 300DraftColorCMYK 300FastDraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
			 '300ColorCMYK 300ColorCMYKFullBleed ' .
			 '600ColorCMYK 600ColorCMYKFullBleed ' .
			 '1200PhotoCMYK 1200PhotoCMYKFullBleed ' .
                         '600CDDVDCMYK', 
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (auto-detect paper type)',
		'value' => 'Quality=300FastDraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (auto-detect paper type)',
		'value' => 'Quality=300FastDraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (auto-detect paper type)',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (auto-detect paper type)',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (auto-detect paper type)',
		'value' => 'Quality=600ColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (auto-detect paper type)',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYKFullBleed',
		'constraints' => ''
	    },
            'CDDVDColor' => {
		'longname' => 'CD or DVD',
		'value' => 'Quality=600CDDVDCMYK',
		'constraints' => ''
            }
	}
    },
    'BI1100' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300FastDraftGrayscaleCMYK 300DraftColorCMYK 300FastDraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
			 '300ColorCMYK ' .
			 '600ColorCMYK ' .
			 '1200PhotoCMYK 600PhotoNormalCMYK 600PhotoCMYK',
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (auto-detect paper type)',
		'value' => 'Quality=300FastDraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (auto-detect paper type)',
		'value' => 'Quality=300FastDraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (auto-detect paper type)',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (auto-detect paper type)',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (auto-detect paper type)',
		'value' => 'Quality=600ColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (auto-detect paper type)',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
            'PhotoNormal' => {
		'longname' => 'Normal Quality (color on photo paper)',
		'value' => 'Quality=600PhotoNormalCMYK',
		'constraints' => ''
	    },
           'PhotoBest' => {
		'longname' => 'Best Quality (color on photo paper)',
		'value' => 'Quality=600PhotoCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYK',
		'constraints' => ''
	    }
	}
    },
    'DJ450' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600ColorCMYK',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMYK ' . 
			 '300GrayscaleCMYK 600GrayscaleCMYK ' .
			 '300ColorCMYK 600ColorCMYK ' .
			 '300PhotoCMYK 600PhotoCMYK 1200PhotoCMYK',
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=300DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality',
		'value' => 'Quality=600ColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYK',
		'constraints' => ''
	    }
	}
    },
    'DJ3320' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleK 300DraftColorCMY ' .
	                 '300DraftColorCMYK ' .
			 '300GrayscaleK 300ColorCMY 300ColorCMYK ' .
			 '600GrayscaleK 600ColorCMY 600ColorCMYK ' .
			 '300PhotoCMY 300PhotoCMYK ' .
			 '600PhotoCMY 600PhotoCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black cartridge)',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black cartridge)',
		'value' => 'Quality=300GrayscaleK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (Color cartridge)',
		'value' => 'Quality=600ColorCMY',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black cartridge)',
		'value' => 'Quality=600GrayscaleK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Color cartridge, on photo paper)',
		'value' => 'Quality=600PhotoCMY',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ3600' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleK 300DraftColorCMY ' .
	                 '300DraftColorCMYK ' .
			 '300GrayscaleK 300ColorCMY 300ColorCMYK ' .
			 '600GrayscaleK 600ColorCMY 600ColorCMYK ' .
			 '300PhotoCMY 300PhotoCMYK 300PhotoCMYFullBleed 300PhotoCMYKFullBleed ' .
			 '600PhotoCMY 600PhotoCMYK 600PhotoCMYFullBleed 600PhotoCMYKFullBleed ' .
          '600PhotoCMYcmK 600PhotoCMYcmKFullBleed',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black cartridge)',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black cartridge)',
		'value' => 'Quality=300GrayscaleK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (Color cartridge)',
		'value' => 'Quality=600ColorCMY',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black cartridge)',
		'value' => 'Quality=600GrayscaleK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Color cartridge, on photo paper)',
		'value' => 'Quality=600PhotoCMYKFullBleed',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'DJ4100' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600ColorCMYK',
	'QualityVals' => '600DraftGrayscaleK 600DraftColorCMY ' .
	                 '600DraftColorCMYK ' .
			 '600GrayscaleK 600ColorCMY 600ColorCMYK ' .
			 '600PhotoCMY 600PhotoCMYK 600PhotoCMYFullBleed 600PhotoCMYKFullBleed ' .
          '600PhotoCMYcmK 600PhotoCMYcmKFullBleed',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=600DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black cartridge)',
		'value' => 'Quality=600DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=600ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black cartridge)',
		'value' => 'Quality=600GrayscaleK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (Color cartridge)',
		'value' => 'Quality=600ColorCMY',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black cartridge)',
		'value' => 'Quality=600GrayscaleK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Color cartridge, on photo paper)',
		'value' => 'Quality=600PhotoCMYKFullBleed',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'AP2xxx' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMY ' .
	                 '300DraftColorCMYK ' .
			 '300GrayscaleCMYK 300ColorCMY 300ColorCMYK ' .
			 '300PhotoCMYcmK ' .
	                 '600x300BestGrayscaleCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black + color cartridge)',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black + color cartridge)',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black + color cartridge)',
		'value' => 'Quality=600x300BestGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Photo + color cartridge, photo paper)',
		'value' => 'Quality=300PhotoCMYcmK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'AP21xx' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMY ' .
	                 '300DraftColorCMYK ' .
			 '300GrayscaleCMYK 300ColorCMY 300ColorCMYK ' .
			 '300PhotoCMYcmK ' .
	                 '600x300BestGrayscaleCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black + color cartridge)',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black + color cartridge)',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black + color cartridge)',
		'value' => 'Quality=600x300BestGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Photo + color cartridge, photo paper)',
		'value' => 'Quality=300PhotoCMYcmK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'AP2560' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMY',
	'QualityVals' => '300DraftGrayscaleCMYK 300DraftColorCMY ' .
	                 '300DraftColorCMYK ' .
			 '300GrayscaleCMYK 300ColorCMY 300ColorCMYK ' .
			 '300PhotoCMYcmK ' .
	                 '600x300BestGrayscaleCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Color cartridge)',
		'value' => 'Quality=300DraftColorCMY',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale (Black + color cartridge)',
		'value' => 'Quality=300DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal (Color cartridge)',
		'value' => 'Quality=300ColorCMY',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale (Black + color cartridge)',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale (Black + color cartridge)',
		'value' => 'Quality=600x300BestGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (Photo + color cartridge, photo paper)',
		'value' => 'Quality=300PhotoCMYcmK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'PSP100' => {
	'PageSizeDefault' => 'PhotoTearOff',
	'QualityDefault' => '600ColorCMY',
	'QualityVals' => '300ColorCMY 300ColorCMYFullBleed ' . 
                         '600ColorCMY 600ColorCMYFullBleed ' .
			 '1200PhotoCMY 1200PhotoCMYFullBleed',
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Photo', 
	'PrintoutModeVals' => {
	    'Normal' => {
		'longname' => 'Normal (auto-detect paper type)',
		'value' => 'Quality=300ColorCMYKFullBleed',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (auto-detect paper type)',
		'value' => 'Quality=600ColorCMYKFullBleed',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYKFullBleed',
		'constraints' => ''
	    }
	}
    },
    'PSP470' => {
	'PageSizeDefault' => 'PhotoTearOff',
	'QualityDefault' => '600ColorCMY',
	'QualityVals' => '300ColorCMY 300ColorCMYFullBleed ' . 
                         '600ColorCMY 600ColorCMYFullBleed ' .
			 '1200PhotoCMY 1200PhotoCMYFullBleed',
	'PPDDefaultResolution' => '1200',
	'InputSlot' => 0,
	'Duplex' => 0,
	'PrintoutModeDefault' => 'Photo', 
	'PrintoutModeVals' => {
	    'Normal' => {
		'longname' => 'Normal (auto-detect paper type)',
		'value' => 'Quality=300ColorCMYKFullBleed',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality (auto-detect paper type)',
		'value' => 'Quality=600ColorCMYKFullBleed',
		'constraints' => ''
	    },
	    'Photo' => {
		'longname' => 'Photo (on photo paper)',
		'value' => 'Quality=1200PhotoCMYKFullBleed',
		'constraints' => ''
	    }
	}
    },
    'LJMono' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600GrayscaleK',
	'QualityVals' => '300DraftGrayscaleK 300GrayscaleK 600GrayscaleK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal',
	# "QualityType" is a PJL option (opt/88.xml in foomatic-db,
	# "@PJL SET PRINTQUALITY=DRAFT/NORMAL/HIGH") which exists for
	# some HP laser printers. We couple it to the "PrintoutMode"
	# option here. If the printer has no "QualityType" option,
	# the "QualityType" settings will be removed from the
	# "PrintoutMode" option in the PPD file.
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Economy)',
		'value' => 'Quality=300DraftGrayscaleK QualityType=Draft',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300GrayscaleK QualityType=Normal',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality',
		'value' => 'Quality=600GrayscaleK QualityType=High',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
    <monochrome />
   </functionality>
'
    },
    'LJMono300' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300DraftGrayscaleK',
	'QualityVals' => '300DraftGrayscaleK',
	'PPDDefaultResolution' => '300',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300DraftGrayscaleK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>300</maxresx>
    <maxresy>300</maxresy>
    <monochrome />
    <text>60</text>
    <lineart>60</lineart>
    <graphics>30</graphics>
    <photo>30</photo>
   </functionality>
'
    },
    'LJColor' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '150DraftGrayscaleCMYK 150DraftColorCMYK ' .
			 '150GrayscaleCMYK 150ColorCMYK 150BestColorCMYK ' .
			 '300GrayscaleCMYK 300ColorCMYK 300BestColorCMYK ' .
			 '600GrayscaleCMYK 600BestColorCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=150DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=150DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality',
		'value' => 'Quality=600BestColorCMYK',
		'constraints' => ''
	    },
	    'High.Gray' => {
		'longname' => 'High Quality Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
   </functionality>
'
    },
    'LJColor300' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '300ColorCMYK',
	'QualityVals' => '150DraftGrayscaleCMYK 150DraftColorCMYK ' .
			 '150GrayscaleCMYK 150ColorCMYK 150BestColorCMYK ' .
			 '300GrayscaleCMYK 300ColorCMYK 300BestColorCMYK',
	'PPDDefaultResolution' => '300',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft',
		'value' => 'Quality=150DraftColorCMYK',
		'constraints' => ''
	    },
	    'Draft.Gray' => {
		'longname' => 'Draft Grayscale',
		'value' => 'Quality=150DraftGrayscaleCMYK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=300ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=300GrayscaleCMYK',
		'constraints' => ''
	    },
	    'High' => {
		'longname' => 'High Quality',
		'value' => 'Quality=300BestColorCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>300</maxresx>
    <maxresy>300</maxresy>
   </functionality>
'
    },
    'LJFastRaster' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600GrayscaleK',
	'QualityVals' => '600DraftGrayscaleK 600GrayscaleK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal',
	'PrintoutModeVals' => {
	    'Draft' => {
		'longname' => 'Draft (Economy)',
		'value' => 'Quality=600DraftGrayscaleK',
		'constraints' => ''
	    },
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=600GrayscaleK',
		'constraints' => ''
	    },
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
    <monochrome />
   </functionality>
'
	}
    },
    'LJJetReady' => {
	'PageSizeDefault' => 'Letter',
	'QualityDefault' => '600ColorCMYK',
	'QualityVals' => '600GrayscaleCMYK 600ColorCMYK',
	'PPDDefaultResolution' => '600',
	'InputSlot' => 1,
	'Duplex' => 1,
	'PrintoutModeDefault' => 'Normal', 
	'PrintoutModeVals' => {
	    'Normal' => {
		'longname' => 'Normal',
		'value' => 'Quality=600ColorCMYK',
		'constraints' => ''
	    },
	    'Normal.Gray' => {
		'longname' => 'Normal Grayscale',
		'value' => 'Quality=600GrayscaleCMYK',
		'constraints' => ''
	    }
	},
	'drvfunctionality' =>
'   <functionality>
    <maxresx>600</maxresx>
    <maxresy>600</maxresy>
    <text>60</text>
    <lineart>60</lineart>
    <graphics>50</graphics>
    <photo>50</photo>
   </functionality>
'
    }
};

# Variable to collect the printer entries for the driver XML file
my @printerlist = ();

# Variables to collect the constraint entries

my @model_constraints = ();
my @pagesize_constraints = ();
my @quality_constraints = ();
my @printoutmode_constraints = ();
my @duplex_constraints = ();
my @inputslot_constraints = ();

# Variable to collect the model values

my @model_values = ();

# Read the printermap file and insert the printers into the appropriate 
# constraint lists

open PRINTERMAP, "< $mapfile" ||
    die "Printer map file $mapfile not found or not readable: $!\n";

print "Processing printer entries:\n\n";

while (my $line = <PRINTERMAP>) {
    chomp ($line);
    # Comment line or blank line
    next if (($line =~ /^\s*$/) || ($line =~ /^\s*\#/));
    # Extract the fields of the printer entry
    my ($id, $make, $model, $group, $maxpapersize, $comment) = 
	split(/\|/, $line);
    # Valid entry?
    next if (($id eq "") || ($make eq "") || 
	     ($model eq "") || ($group eq ""));
    # Is the contents of the group field valid?
    die "Printer $id: The group \"$group\" does not exist!\n" 
	if (!$printer_groups->{$group});
    # Is the maximum paper size valid?
    die "Printer $id: The paper size \"$maxpapersize\" does not exist!\n" 
	if (!$pagesize_vals->{$maxpapersize});
    # Set up comment
    if (($comment) && ($comment ne "")) {
	$comment = "<!-- $comment -->";
    }

    # Default resolution entry for the PPD file

    my $ppddefaultresolution = $ppd_default_resolution_xml;
    $ppddefaultresolution =~
	s/\@\@RES\@\@/$printer_groups->{$group}{'PPDDefaultResolution'}/g;

    # Margins for the current printer

    my $margins = "";
    my $gmargins;
    $gmargins->{'left'} = $general_margins->{'left'};
    $gmargins->{'right'} = $general_margins->{'right'};
    $gmargins->{'top'} = $general_margins->{'top'};
    $gmargins->{'bottom'} = $general_margins->{'bottom'};
    if (($group =~ /^AP/) ||
	($group =~ /^DJ(350|400|500|540|600|6xx|630)/)) {
	# Older inkjets (AP2xxx, AP21xx, AP2560, DJ350. DJ400, DJ500,
	# DJ540, DJ600, DJ6xx, DJ630, DJ6xxPhoto)
	$gmargins->{'bottom'} = $oldinkjet_bottom;
	my ($m1, $m2, $m3); 
	$m1 = $left_margin_xml;
	$m1 =~ s/\@\@LEFT\@\@/$oldinkjet_a4_sides/;
	$m2 .= $m1;
	$m1 = $right_margin_xml;
	$m1 =~ s/\@\@RIGHT\@\@/$oldinkjet_a4_sides/;
	$m2 .= $m1;
	$m3 = $papersize_margins_xml;
	$m3 =~ s/\@\@PAPERSIZE\@\@/A4/;
	$m3 =~ s/\@\@MARGINVALUES\@\@/$m2/;
	$margins = $m3;
    } elsif ($group =~ /^LJ/) {
	# Laser printers (LJMono, LJMono300, LJColor, LJColor300)
	$gmargins->{'top'} = $general_laser_margins->{'top'};
	$gmargins->{'bottom'} = $general_laser_margins->{'bottom'};
    } elsif ($group =~ /^PSP/) {
	# Portable 4x6 photo inkjets do full-bleed on all paper sizes
	$gmargins->{'left'} = 0;
	$gmargins->{'right'} = 0;
	$gmargins->{'top'} = 0;
	my ($m1, $m2, $m3); 
	$m1 = $bottom_margin_xml;
	$m1 =~ s/\@\@BOTTOM\@\@/0/;
	$m2 .= $m1;
	$m3 = $papersize_margins_xml;
	$m3 =~ s/\@\@PAPERSIZE\@\@/PhotoTearOff/;
	$m3 =~ s/\@\@MARGINVALUES\@\@/$m2/;
	$margins .= $m3;
	$m3 = $papersize_margins_xml;
	$m3 =~ s/\@\@PAPERSIZE\@\@/A6TearOff/;
	$m3 =~ s/\@\@MARGINVALUES\@\@/$m2/;
	$margins .= $m3;
    } else {
	# All the other printers (recent inkjets)
	my $maxsize_found = 0;
	my $oufuku_and_smaller = 0;
	my $dj450_photo_feeder = 0;
	for my $value (@pagesize_size_order) {
	    if ($value eq $maxpapersize) {
		# Take into account only paper sizes which fit into the printer
		$maxsize_found = 1;
	    }
	    if ($value =~ /^Oufuku/i) {
		# Full-Bleed on DJGenericVIP models works only with
		# Oufuku-Hagaki and smaller paper sizes
		$oufuku_and_smaller = 1;
	    }
	    my $cmdlinepapersize = 
		$pagesize_vals->{$value}{'driverval'};
	    $cmdlinepapersize =~ /DEVICEWIDTHPOINTS=([\d\.]+)/;
	    my $paperwidthpoints = $1;
	    if ($paperwidthpoints < (4.5 * 72.0)) { # 4.5 inches
		# The unprintable margins are smaller when printing through
		# the photo/card/envelope slot of the HP DeskJet 450, but the
		# slot fits only paper which is not wider than 4.5 inches.
		$dj450_photo_feeder = 1;
	    }
	    if ($maxsize_found) {
		# Calculate margins for the page size $value
		my ($left, $right, $top, $bottom);
		if (($group =~ /^DJGenericVIP/) &&
		    $oufuku_and_smaller) {
		    # Full-bleed on DJGenericVIP models
		    $left = 0.0;
		    $right = 0.0;
		    $top = 0.0;
		    # Full-bleed all around only possible on papers with
		    # tear-off tab
		    if ($value =~ /TearOff$/i) {
			$bottom = 0.0;
		    } else {
			$bottom = 0.5;
		    }
		} elsif (($group =~ /^DJ450$/) &&
			 $dj450_photo_feeder) {
		    # Small unprintable margins in photo/card/envelope feeder
		    # of DeskJet 450
		    $left = $dj450_photo_margins->{'left'};
		    $right = $dj450_photo_margins->{'right'};
		    $top = $dj450_photo_margins->{'top'};
		    # tear-off tab allows symmetric margins
		    if ($value =~ /TearOff$/i) {
			$bottom = $dj450_photo_margins->{'bottomtearoff'};
		    } else {
			$bottom = $dj450_photo_margins->{'bottom'};
		    }
		} elsif (!defined($pagesize_vals->{$value}{'margins'})) {
		    # No papersize-specific definitions for margins, use the
		    # default margins
		    next;
		} else {
		    $left = 0.5 *
		       ($pagesize_vals->{$value}{'margins'}{'width'} -
			$pagesize_vals->{$value}{'margins'}{'printablewidth'});
		    $right = $left;
		    $top =
		       $pagesize_vals->{$value}{'margins'}{'topmargin'};
		    $bottom =
		       $pagesize_vals->{$value}{'margins'}{'height'} -
		       $pagesize_vals->{$value}{'margins'}{'printableheight'} -
		       $pagesize_vals->{$value}{'margins'}{'topmargin'};
		}
		# Compare margins with general margins and make only
		# entries for page sizes which differ in at least one
		# value.
		if (($gmargins->{'left'} != $left) ||
		    ($gmargins->{'right'} != $right) ||
		    ($gmargins->{'top'} != $top) ||
		    ($gmargins->{'bottom'} != $bottom)) {
		    my ($m1, $m2, $m3); 
		    if ($gmargins->{'left'} != $left) {
			$m1 = $left_margin_xml;
			$m1 =~ s/\@\@LEFT\@\@/$left/;
			$m2 .= $m1;
		    }
		    if ($gmargins->{'right'} != $right) {
			$m1 = $right_margin_xml;
			$m1 =~ s/\@\@RIGHT\@\@/$right/;
			$m2 .= $m1;
		    }
		    if ($gmargins->{'top'} != $top) {
			$m1 = $top_margin_xml;
			$m1 =~ s/\@\@TOP\@\@/$top/;
			$m2 .= $m1;
		    }
		    if ($gmargins->{'bottom'} != $bottom) {
			$m1 = $bottom_margin_xml;
			$m1 =~ s/\@\@BOTTOM\@\@/$bottom/;
			$m2 .= $m1;
		    }
		    $m3 = $papersize_margins_xml;
		    $m3 =~ s/\@\@PAPERSIZE\@\@/$value/;
		    $m3 =~ s/\@\@MARGINVALUES\@\@/$m2/;
		    $margins .= $m3;
		}
	    }
	}
    }
    # General margins
    my ($m1, $m2, $m3); 
    $m1 = $left_margin_xml;
    $m1 =~ s/\@\@LEFT\@\@/$gmargins->{'left'}/;
    $m2 .= $m1;
    $m1 = $right_margin_xml;
    $m1 =~ s/\@\@RIGHT\@\@/$gmargins->{'right'}/;
    $m2 .= $m1;
    $m1 = $top_margin_xml;
    $m1 =~ s/\@\@TOP\@\@/$gmargins->{'top'}/;
    $m2 .= $m1;
    $m1 = $bottom_margin_xml;
    $m1 =~ s/\@\@BOTTOM\@\@/$gmargins->{'bottom'}/;
    $m2 .= $m1;
    $m3 = $general_margins_xml;
    $m3 =~ s/\@\@MARGINVALUES\@\@/$m2/;
    $margins = $m3 . $margins;

    # Printer entry in driver XML file

    my $printer_entry = $printerlist_xml;
    $printer_entry =~ s/\@\@PRINTERID\@\@/$id/;
    $printer_entry =~ s/\@\@COMMENT\@\@/$comment/;
    $printer_entry =~
	s/\@\@FUNCTIONALITY\@\@/$printer_groups->{$group}{'drvfunctionality'}/;
    $printer_entry =~ s/\@\@PPDDEFAULTRESOLUTION\@\@/$ppddefaultresolution/;
    $printer_entry =~ s/\@\@MARGINS\@\@/$margins/;
    push (@printerlist, $printer_entry);

    # Model option

    my $model_enum_val_id = "hpijs-Model-$id";
    my $model_option_constraint = $hpijs_option_constraint_xml;
    $model_option_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $model_option_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    $model_option_constraint =~
	s/\@\@DEFAULTENUMVALID\@\@/$model_enum_val_id/;
    push (@model_constraints, $model_option_constraint);
    my $model_val_constraint = $hpijs_enum_val_constraint_xml;
    $model_val_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $model_val_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    my $model_driverval = "-sDeviceManufacturer=&quot;$make&quot; -sDeviceModel=&quot;$model&quot;";
    my $model_longname = "";
    my $model_shortname = "";
    if ($id =~ /^\d+$/) { # Old numeric printer ID
	die "Printer $id: Comment field must be filled in when ID is numeric!\n"
	    if ((!$comment) || ($comment eq ""));
	$model_longname = $comment;
	$model_longname =~ s/<!-- //;
	$model_longname =~ s/ -->//;
	$model_shortname = $comment;
	$model_shortname =~ s/<!-- //;
	$model_shortname =~ s/ -->//;
	$model_shortname =~ s/ /-/;
	$model_shortname =~ s/ /_/g;
    } else { # New clear text printer ID
	$model_longname = $id;
	$model_longname =~ s/-/ /;
	$model_longname =~ s/_/ /g;
	$model_shortname = $id;
    }
    # Make use of $model_longname for progress reporting
    print "$model_longname\n";
    my $model_enum_val = $hpijs_enum_val_xml;
    $model_enum_val =~ s/\@\@ENUMVALID\@\@/$model_enum_val_id/;
    $model_enum_val =~ s/\@\@LONGNAME\@\@/$model_longname/;
    $model_enum_val =~ s/\@\@SHORTNAME\@\@/$model_shortname/;
    $model_enum_val =~ s/\@\@DRIVERVALUE\@\@/$model_driverval/;
    $model_enum_val =~ s/\@\@ENUMVALCONSTRAINTS\@\@/$model_val_constraint/;
    push (@model_values, $model_enum_val);

    # PageSize option
    
    my $pagesize_default = 
	"hpijs-PageSize-$printer_groups->{$group}{'PageSizeDefault'}";
    my $pagesize_option_constraint = $hpijs_option_constraint_xml;
    $pagesize_option_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $pagesize_option_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    $pagesize_option_constraint =~
	s/\@\@DEFAULTENUMVALID\@\@/$pagesize_default/;
    push (@pagesize_constraints, $pagesize_option_constraint);
    $pagesize_val_constraint = $hpijs_enum_val_constraint_xml;
    $pagesize_val_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $pagesize_val_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    my $maxsize_found = 0;
    for my $value (@pagesize_size_order) {
	if ($value eq $maxpapersize) {
	    $maxsize_found = 1;
	}
	# Papers with tear-off tab exist only for inkjets, so skip them
	# for lasers
	next if (($group =~ /^LJ/) && ($value =~ /TearOff/));
	# The special size "3425-Cover" is only for the LIDIL printers
	next if (($group !~ /^DJ3320/) && ($value =~ /3425-Cover/));
	if ($maxsize_found) {
	    $pagesize_vals->{$value}{'constraints'} .=
		$pagesize_val_constraint;
	}
    }

    # Quality option
    
    my $quality_default = 
	"hpijs-Quality-$printer_groups->{$group}{'QualityDefault'}";
    my $quality_option_constraint = $hpijs_option_constraint_xml;
    $quality_option_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $quality_option_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    $quality_option_constraint =~
	s/\@\@DEFAULTENUMVALID\@\@/$quality_default/;
    push (@quality_constraints, $quality_option_constraint);
    $quality_val_constraint = $hpijs_enum_val_constraint_xml;
    $quality_val_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $quality_val_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    for my $value (split(/ /, $printer_groups->{$group}{'QualityVals'})) {
	$quality_vals->{$value}{'constraints'} .=
	    $quality_val_constraint;
    }

    # PrintoutMode option
    
    my $printoutmode_default = 
	"hpijs-PrintoutMode-$printer_groups->{$group}{'PrintoutModeDefault'}-$group";
    my $printoutmode_option_constraint = $hpijs_option_constraint_xml;
    $printoutmode_option_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $printoutmode_option_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    $printoutmode_option_constraint =~
	s/\@\@DEFAULTENUMVALID\@\@/$printoutmode_default/;
    push (@printoutmode_constraints, $printoutmode_option_constraint);
    $printoutmode_val_constraint = $hpijs_enum_val_constraint_xml;
    $printoutmode_val_constraint =~ s/\@\@PRINTERID\@\@/$id/;
    $printoutmode_val_constraint =~ s/\@\@COMMENT\@\@/$comment/;
    for my $value (keys %{$printer_groups->{$group}{'PrintoutModeVals'}}) {
	$printer_groups->{$group}{'PrintoutModeVals'}{$value}{'constraints'}
	.= $printoutmode_val_constraint;
    }

    # InputSlot option

    if ($printer_groups->{$group}{'InputSlot'} == 1) {
	my $inputslot_option_constraint = $hpijs_option_constraint_xml;
	$inputslot_option_constraint =~ s/\@\@PRINTERID\@\@/$id/;
	$inputslot_option_constraint =~ s/\@\@COMMENT\@\@/$comment/;
	$inputslot_option_constraint =~
	s/\@\@DEFAULTENUMVALID\@\@/hpijs-InputSlot-Default/;
	push (@inputslot_constraints, $inputslot_option_constraint);
    }

    # Duplex option

    if ($printer_groups->{$group}{'Duplex'} == 1) {
	my $duplex_option_constraint = $hpijs_option_constraint_xml;
	$duplex_option_constraint =~ s/\@\@PRINTERID\@\@/$id/;
	$duplex_option_constraint =~ s/\@\@COMMENT\@\@/$comment/;
	$duplex_option_constraint =~
	s/\@\@DEFAULTENUMVALID\@\@/hpijs-Duplex-None/;
	push (@duplex_constraints, $duplex_option_constraint);
    }

}
close PRINTERMAP;

# Set up the directories for the XML files

mkdir 'foomatic-db', 0755 or die "Cannot create directory foomatic-db: $!\n"
    unless -d 'foomatic-db';
mkdir 'foomatic-db/opt', 0755 or die "Cannot create directory foomatic-db/opt: $!\n"
    unless -d 'foomatic-db/opt';
mkdir 'foomatic-db/driver', 0755 or die "Cannot create directory foomatic-db/driver: $!\n"
    unless -d 'foomatic-db/driver';

# Create the XML files

# foomatic-db/driver/hpijs.xml

print "\nCreating foomatic-db/driver/hpijs.xml ...\n";
my $printerentries = join('', @printerlist);
$hpijs_driver_xml =~ s/\@\@PRINTERENTRIES\@\@/$printerentries/;
open HPIJS_XML, "> foomatic-db/driver/hpijs.xml" ||
    die "Cannot write file foomatic-db/driver/hpijs.xml: $!\n";
print HPIJS_XML $hpijs_driver_xml;
close HPIJS_XML;

# foomatic-db/opt/hpijs-Model.xml

print "Creating foomatic-db/opt/hpijs-Model.xml ...\n";
my $modelconstraints = join('', @model_constraints);
my $modelenumvals = join('', @model_values);
$hpijs_model_xml =~ s/\@\@MODELCONSTRAINTS\@\@/$modelconstraints/;
$hpijs_model_xml =~ s/\@\@MODELENUMVALS\@\@/$modelenumvals/;
open HPIJS_MODEL_XML, "> foomatic-db/opt/hpijs-Model.xml" ||
    die "Cannot write file foomatic-db/opt/hpijs-Model.xml: $!\n";
print HPIJS_MODEL_XML $hpijs_model_xml;
close HPIJS_MODEL_XML;

# foomatic-db/opt/hpijs-PageSize.xml

print "Creating foomatic-db/opt/hpijs-PageSize.xml ...\n";
my $pagesize_values = ();
for my $value (@pagesize_order) {
    my $pagesize_val_constraints =
	$pagesize_vals->{$value}{'constraints'};
    my $pagesize_enum_val = $hpijs_enum_val_xml;
    $pagesize_enum_val =~ s/\@\@ENUMVALID\@\@/hpijs-PageSize-$value/;
    $pagesize_enum_val =~
	s/\@\@LONGNAME\@\@/$pagesize_vals->{$value}{'longname'}/;
    $pagesize_enum_val =~ s/\@\@SHORTNAME\@\@/$value/;
    $pagesize_enum_val =~
	s/\@\@DRIVERVALUE\@\@/$pagesize_vals->{$value}{'driverval'}/;
    $pagesize_enum_val =~
      s/\@\@ENUMVALCONSTRAINTS\@\@/$pagesize_val_constraints/;
    push (@pagesize_values, $pagesize_enum_val);
}
my $pagesizeconstraints = join('', @pagesize_constraints);
my $pagesizeenumvals = join('', @pagesize_values);
$hpijs_pagesize_xml =~ s/\@\@PAGESIZECONSTRAINTS\@\@/$pagesizeconstraints/;
$hpijs_pagesize_xml =~ s/\@\@PAGESIZEENUMVALS\@\@/$pagesizeenumvals/;
open HPIJS_PAGESIZE_XML, "> foomatic-db/opt/hpijs-PageSize.xml" ||
    die "Cannot write file foomatic-db/opt/hpijs-PageSize.xml: $!\n";
print HPIJS_PAGESIZE_XML $hpijs_pagesize_xml;
close HPIJS_PAGESIZE_XML;

# foomatic-db/opt/hpijs-Quality.xml

print "Creating foomatic-db/opt/hpijs-Quality.xml ...\n";
my $quality_values = ();
for my $value (@quality_order) {
    my $quality_val_constraints =
	$quality_vals->{$value}{'constraints'};
    my $quality_enum_val = $hpijs_enum_val_xml;
    $quality_enum_val =~ s/\@\@ENUMVALID\@\@/hpijs-Quality-$value/;
    $quality_enum_val =~
	s/\@\@LONGNAME\@\@/$quality_vals->{$value}{'longname'}/;
    $quality_enum_val =~ s/\@\@SHORTNAME\@\@/$value/;
    $quality_enum_val =~
	s/\@\@DRIVERVALUE\@\@/$quality_vals->{$value}{'driverval'}/;
    $quality_enum_val =~
      s/\@\@ENUMVALCONSTRAINTS\@\@/$quality_val_constraints/;
    push (@quality_values, $quality_enum_val);
}
my $qualityconstraints = join('', @quality_constraints);
my $qualityenumvals = join('', @quality_values);
$hpijs_quality_xml =~ s/\@\@QUALITYCONSTRAINTS\@\@/$qualityconstraints/;
$hpijs_quality_xml =~ s/\@\@QUALITYENUMVALS\@\@/$qualityenumvals/;
open HPIJS_QUALITY_XML, "> foomatic-db/opt/hpijs-Quality.xml" ||
    die "Cannot write file foomatic-db/opt/hpijs-Quality.xml: $!\n";
print HPIJS_QUALITY_XML $hpijs_quality_xml;
close HPIJS_QUALITY_XML;

# foomatic-db/opt/hpijs-PrintoutMode.xml

print "Creating foomatic-db/opt/hpijs-PrintoutMode.xml ...\n";
my $printoutmode_values = ();
for my $group (keys %{$printer_groups}) {
    for my $value (keys %{$printer_groups->{$group}{'PrintoutModeVals'}}) {
	my $printoutmode_val_constraints =
	    $printer_groups->{$group}{'PrintoutModeVals'}{$value}{'constraints'};
	my $printoutmode_enum_val = $hpijs_enum_val_xml;
	$printoutmode_enum_val =~ 
	    s/\@\@ENUMVALID\@\@/hpijs-PrintoutMode-$value-$group/;
	$printoutmode_enum_val =~
	    s/\@\@LONGNAME\@\@/$printer_groups->{$group}{'PrintoutModeVals'}{$value}{'longname'}/;
	$printoutmode_enum_val =~ s/\@\@SHORTNAME\@\@/$value/;
	$printoutmode_enum_val =~
	    s/\@\@DRIVERVALUE\@\@/$printer_groups->{$group}{'PrintoutModeVals'}{$value}{'value'}/;
	$printoutmode_enum_val =~
	    s/\@\@ENUMVALCONSTRAINTS\@\@/$printoutmode_val_constraints/;
	push (@printoutmode_values, $printoutmode_enum_val);
    }
}
my $printoutmodeconstraints = join('', @printoutmode_constraints);
my $printoutmodeenumvals = join('', @printoutmode_values);
$hpijs_printoutmode_xml =~ s/\@\@PRINTOUTMODECONSTRAINTS\@\@/$printoutmodeconstraints/;
$hpijs_printoutmode_xml =~ s/\@\@PRINTOUTMODEENUMVALS\@\@/$printoutmodeenumvals/;
open HPIJS_PRINTOUTMODE_XML, "> foomatic-db/opt/hpijs-PrintoutMode.xml" ||
    die "Cannot write file foomatic-db/opt/hpijs-PrintoutMode.xml: $!\n";
print HPIJS_PRINTOUTMODE_XML $hpijs_printoutmode_xml;
close HPIJS_PRINTOUTMODE_XML;

# foomatic-db/opt/hpijs-InputSlot.xml

print "Creating foomatic-db/opt/hpijs-InputSlot.xml ...\n";
my $inputslotconstraints = join('', @inputslot_constraints);
$hpijs_inputslot_xml =~
    s/\@\@INPUTSLOTCONSTRAINTS\@\@/$inputslotconstraints/;
open HPIJS_INPUTSLOT_XML, "> foomatic-db/opt/hpijs-InputSlot.xml" ||
    die "Cannot write file foomatic-db/opt/hpijs-InputSlot.xml: $!\n";
print HPIJS_INPUTSLOT_XML $hpijs_inputslot_xml;
close HPIJS_INPUTSLOT_XML;

# foomatic-db/opt/hpijs-Duplex.xml

print "Creating foomatic-db/opt/hpijs-Duplex.xml ...\n";
my $duplexconstraints = join('', @duplex_constraints);
$hpijs_duplex_xml =~ s/\@\@DUPLEXCONSTRAINTS\@\@/$duplexconstraints/;
open HPIJS_DUPLEX_XML, "> foomatic-db/opt/hpijs-Duplex.xml" ||
    die "Cannot write file foomatic-db/opt/hpijs-Duplex.xml: $!\n";
print HPIJS_DUPLEX_XML $hpijs_duplex_xml;
close HPIJS_DUPLEX_XML;

# Was a path for the database given on the command line?

my $libdir = "../..";
if ($ARGV[0]) {
    $libdir = $ARGV[0];
}

# Moving generated files into the database

if ( -d "$libdir/db/source/driver/" ) { 
    print "\nMoving HPIJS Foomatic entries into the database ...\n";
    system "mv -f foomatic-db/driver/*.xml $libdir/db/source/driver/; mv -f foomatic-db/opt/*.xml $libdir/db/source/opt/; rm -f $libdir/db/source/opt/hpijs-Resolution.xml; rm -rf foomatic-db" ||
	die "Cannot move the generated XML files into the Foomatic database!";
}

# Done

print "\nDone,\n\n";
exit 0;
